<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Child Health Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-gradient: radial-gradient(circle at top left, #2f4369 0, #1f2933 35%, #111827 100%);
      --primary: #6366f1;
      --primary-soft: rgba(99, 102, 241, 0.16);
      --primary-strong: #4f46e5;
      --accent: #f97316;
      --card-bg: rgba(15, 23, 42, 0.82);
      --border-subtle: rgba(148, 163, 184, 0.35);
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --text-soft: #6b7280;
      --glass-shadow: 0 24px 60px rgba(15, 23, 42, 0.7);
      --radius-xl: 18px;
      --radius-lg: 14px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      min-height: 100vh;
      background: var(--bg-gradient);
      color: var(--text-main);
      overflow-x: hidden;
    }

    /* APP SHELL */

    .app-shell {
      display: grid;
      grid-template-columns: 260px minmax(0, 1fr);
      min-height: 100vh;
    }

    @media (max-width: 900px) {
      .app-shell {
        grid-template-columns: 1fr;
      }
    }

    /* SIDEBAR */

    .sidebar {
      position: relative;
      padding: 20px 18px;
      border-right: 1px solid rgba(148, 163, 184, 0.25);
      background: linear-gradient(
        180deg,
        rgba(15, 23, 42, 0.96) 0%,
        rgba(15, 23, 42, 0.9) 50%,
        rgba(17, 24, 39, 0.96) 100%
      );
      backdrop-filter: blur(22px);
      z-index: 20;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 26px;
    }

    .logo-badge {
      width: 34px;
      height: 34px;
      border-radius: 12px;
      background: radial-gradient(circle at 0 0, #f97316, #6366f1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 700;
      color: #f9fafb;
      box-shadow: 0 14px 30px rgba(15, 23, 42, 0.7);
    }

    .brand-text-main {
      font-size: 18px;
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    .brand-text-sub {
      font-size: 11px;
      color: var(--text-soft);
      text-transform: uppercase;
      letter-spacing: 0.14em;
    }

    .sidebar-section-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--text-soft);
      margin: 18px 4px 10px;
    }

    .nav-links {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .nav-links li a {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 9px 10px;
      border-radius: 12px;
      text-decoration: none;
      color: var(--text-muted);
      font-size: 13px;
      transition: background 0.15s ease, color 0.15s ease, transform 0.1s ease;
    }

    .nav-links li a span.icon-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.7);
    }

    .nav-links li a:hover {
      background: rgba(31, 41, 55, 0.9);
      transform: translateY(-1px);
      color: #e5e7eb;
    }

    .nav-links li a.active {
      background: rgba(37, 99, 235, 0.16);
      color: #e5e7eb;
      border: 1px solid rgba(129, 140, 248, 0.8);
    }

    .nav-links li a.active span.icon-dot {
      background: #6366f1;
    }

    .sidebar-footer {
      position: absolute;
      bottom: 16px;
      left: 18px;
      right: 18px;
      font-size: 11px;
      color: var(--text-soft);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .badge-soft {
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      font-size: 11px;
      color: var(--text-muted);
    }

    /* MOBILE NAV TOGGLE */

    .top-mobile-bar {
      display: none;
      position: sticky;
      top: 0;
      z-index: 25;
      padding: 10px 14px;
      background: rgba(15, 23, 42, 0.98);
      border-bottom: 1px solid rgba(148, 163, 184, 0.35);
      align-items: center;
      justify-content: space-between;
    }

    .mobile-brand {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .mobile-menu-toggle {
      width: 34px;
      height: 34px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background: rgba(15, 23, 42, 0.9);
    }

    .mobile-menu-toggle span {
      height: 2px;
      width: 16px;
      background: #e5e7eb;
      position: relative;
    }

    .mobile-menu-toggle span::before,
    .mobile-menu-toggle span::after {
      content: "";
      position: absolute;
      left: 0;
      right: 0;
      height: 2px;
      background: #e5e7eb;
    }

    .mobile-menu-toggle span::before {
      top: -5px;
    }

    .mobile-menu-toggle span::after {
      top: 5px;
    }

    @media (max-width: 900px) {
      .sidebar {
        position: fixed;
        top: 46px;
        left: 0;
        right: 0;
        height: calc(100vh - 46px);
        transform: translateY(-120%);
        transition: transform 0.2s ease-out;
        border-right: none;
        border-bottom: 1px solid rgba(148, 163, 184, 0.25);
      }

      .sidebar.open {
        transform: translateY(0);
      }

      .top-mobile-bar {
        display: flex;
      }
    }

    /* MAIN AREA */

    .main {
      position: relative;
      padding: 18px 26px 26px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    @media (max-width: 600px) {
      .main {
        padding: 14px 14px 20px;
      }
    }

    .main-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 14px;
      margin-bottom: 4px;
    }

    .page-title {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .page-title h1 {
      font-size: 22px;
      font-weight: 600;
      letter-spacing: 0.01em;
    }

    .page-subtitle {
      font-size: 12px;
      color: var(--text-soft);
    }

    .user-chip {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #logout-btn {
      background: rgba(248, 113, 113, 0.12);
      color: #fecaca;
      border: 1px solid rgba(248, 113, 113, 0.4);
      padding: 7px 13px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.15s ease, transform 0.1s ease, box-shadow 0.15s ease;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.6);
    }

    #logout-btn:hover {
      background: rgba(248, 113, 113, 0.2);
      transform: translateY(-1px);
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.8);
    }

    .profile-icon {
      width: 34px;
      height: 34px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0%, #f97316, #6366f1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 700;
      color: #f9fafb;
      box-shadow: 0 14px 36px rgba(15, 23, 42, 0.85);
    }

    /* MODULES STRIP */

    .modules-strip {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 14px;
    }

    .module-card {
      position: relative;
      padding: 14px 14px 12px;
      border-radius: var(--radius-lg);
      background: radial-gradient(circle at top left, rgba(99, 102, 241, 0.22), rgba(15, 23, 42, 0.95));
      border: 1px solid rgba(129, 140, 248, 0.4);
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.8);
      cursor: pointer;
      overflow: hidden;
      transition: transform 0.18s ease, box-shadow 0.18s ease, border 0.18s ease;
    }

    .module-card::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 0 0, rgba(248, 250, 252, 0.18), transparent 60%);
      opacity: 0;
      transition: opacity 0.18s ease;
    }

    .module-card:hover {
      transform: translateY(-3px) scale(1.01);
      box-shadow: 0 26px 60px rgba(15, 23, 42, 0.95);
      border-color: rgba(129, 140, 248, 0.9);
    }

    .module-card:hover::after {
      opacity: 1;
    }

    .module-card.active {
      border: 1px solid #f97316;
    }

    .module-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .module-card h3 {
      font-size: 15px;
      font-weight: 600;
    }

    .module-chip {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.75);
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--text-muted);
      white-space: nowrap;
    }

    .module-footnote {
      font-size: 11px;
      margin-top: 6px;
      color: var(--text-soft);
    }

    /* CARDS / SECTIONS */

    .grid-2 {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
      gap: 16px;
      align-items: flex-start;
      margin-top: 4px;
    }

    @media (max-width: 1100px) {
      .grid-2 {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--glass-shadow);
      padding: 16px 16px 14px;
      backdrop-filter: blur(24px);
    }

    .card + .card {
      margin-top: 12px;
    }

    h2.section-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .section-title span.label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .section-pill {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.55);
      color: var(--text-soft);
    }

    .section-metrics {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 8px;
      margin-top: 4px;
    }

    .metric-pill {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.4);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .metric-label {
      color: var(--text-soft);
    }

    .metric-value {
      font-weight: 600;
      color: #e5e7eb;
    }

    .status-text {
      font-size: 12px;
      color: var(--text-soft);
      margin-bottom: 8px;
    }

    .id-card {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 14px;
      padding-top: 4px;
    }

    .id-primary {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 13px;
    }

    .id-primary span.label-small {
      font-size: 11px;
      color: var(--text-soft);
      text-transform: uppercase;
      letter-spacing: 0.14em;
    }

    .id-name-display {
      font-size: 15px;
      font-weight: 600;
    }

    .id-photo {
      width: 88px;
      height: 88px;
      border-radius: 18px;
      border: 1px dashed rgba(148, 163, 184, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: var(--text-soft);
      background: radial-gradient(circle at 0 0, rgba(248, 250, 252, 0.06), transparent 60%);
    }

    @media (max-width: 600px) {
      .id-card {
        flex-direction: row;
        align-items: flex-start;
      }
    }

    /* FORMS */

    .form-inline {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-bottom: 8px;
    }

    .form-inline input,
    .form-inline select,
    .table-tools input,
    .table-tools select {
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(55, 65, 81, 0.85);
      background: rgba(15, 23, 42, 0.92);
      color: #e5e7eb;
      font-size: 12px;
      outline: none;
      transition: border 0.15s ease, box-shadow 0.15s ease, transform 0.1s ease, background 0.15s ease;
    }

    .form-inline input::placeholder,
    .table-tools input::placeholder {
      color: rgba(148, 163, 184, 0.8);
    }

    .form-inline input:focus,
    .form-inline select:focus,
    .table-tools input:focus,
    .table-tools select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(129, 140, 248, 0.6);
      transform: translateY(-1px);
      background: rgba(15, 23, 42, 0.98);
    }

    .btn-small {
      padding: 7px 16px;
      border-radius: 999px;
      border: 1px solid rgba(129, 140, 248, 0.9);
      cursor: pointer;
      background: linear-gradient(135deg, var(--primary), var(--primary-strong));
      color: #f9fafb;
      font-size: 12px;
      font-weight: 500;
      margin-top: 2px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.15s ease, box-shadow 0.15s ease, filter 0.15s ease, background 0.15s ease;
      box-shadow: 0 14px 30px rgba(15, 23, 42, 0.9);
    }

    .btn-small span.spinner {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 999px;
      border: 2px solid rgba(248, 250, 252, 0.4);
      border-top-color: #f9fafb;
      animation: spin 0.7s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .btn-small:hover:not(:disabled) {
      transform: translateY(-1px);
      filter: brightness(1.06);
      box-shadow: 0 18px 36px rgba(15, 23, 42, 0.98);
    }

    .btn-small:disabled {
      opacity: 0.7;
      cursor: default;
      box-shadow: none;
    }

    /* TABLES */

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 12px;
    }

    thead {
      background: rgba(15, 23, 42, 0.96);
    }

    thead th {
      padding: 8px 8px;
      text-align: left;
      color: var(--text-soft);
      font-weight: 500;
      border-bottom: 1px solid rgba(31, 41, 55, 0.9);
    }

    tbody tr {
      border-bottom: 1px solid rgba(31, 41, 55, 0.85);
      transition: background 0.12s ease, transform 0.06s ease, box-shadow 0.12s ease;
    }

    tbody tr:last-child {
      border-bottom: none;
    }

    tbody td {
      padding: 7px 8px;
      color: #e5e7eb;
    }

    tbody tr:hover {
      background: rgba(15, 23, 42, 0.96);
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.85);
    }

    .table-empty {
      text-align: center;
      font-size: 12px;
      color: var(--text-soft);
    }

    .skeleton-row td {
      padding: 8px;
    }

    .skeleton {
      width: 100%;
      height: 8px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(148, 163, 184, 0.15), rgba(75, 85, 99, 0.7), rgba(148, 163, 184, 0.18));
      background-size: 200% 100%;
      animation: shimmer 1s ease-in-out infinite;
    }

    @keyframes shimmer {
      0% { background-position: 0% 0; }
      50% { background-position: 100% 0; }
      100% { background-position: 0% 0; }
    }

    .table-tools {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-top: 8px;
      margin-bottom: 4px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 500;
    }

    .pill-scheduled {
      background: rgba(250, 204, 21, 0.14);
      color: #facc15;
      border: 1px solid rgba(250, 204, 21, 0.6);
    }

    .pill-given,
    .pill-completed {
      background: rgba(22, 163, 74, 0.16);
      color: #4ade80;
      border: 1px solid rgba(74, 222, 128, 0.7);
    }

    .pill-missed,
    .pill-cancelled {
      background: rgba(248, 113, 113, 0.18);
      color: #fecaca;
      border: 1px solid rgba(248, 113, 113, 0.8);
    }

    /* PLACEHOLDER TEXT SECTIONS */

    .section-note {
      font-size: 12px;
      color: var(--text-soft);
      margin-top: 4px;
    }

    /* TOAST */

    #toast {
      position: fixed;
      bottom: 18px;
      right: 18px;
      padding: 9px 15px;
      border-radius: 999px;
      background: rgba(22, 163, 74, 0.98);
      color: #ecfdf5;
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.9);
      opacity: 0;
      transform: translateY(12px);
      pointer-events: none;
      transition: opacity 0.18s ease, transform 0.18s ease;
      z-index: 40;
    }

    #toast.error {
      background: rgba(220, 38, 38, 0.98);
      color: #fee2e2;
    }

    #toast.show {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    @media (max-width: 600px) {
      #toast {
        left: 10px;
        right: 10px;
        justify-content: center;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <!-- MOBILE TOP BAR -->
  <div class="top-mobile-bar">
    <div class="mobile-brand">
      <div class="logo-badge">C</div>
      <div>
        <div class="brand-text-main" style="font-size:14px;">Child Health</div>
        <div class="brand-text-sub" style="font-size:9px;">Dashboard</div>
      </div>
    </div>
    <div class="mobile-menu-toggle" onclick="toggleMenu()">
      <span></span>
    </div>
  </div>

  <div class="app-shell">
    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo-badge">C</div>
        <div>
          <div class="brand-text-main">Child Health</div>
          <div class="brand-text-sub">Smart Care Tracker</div>
        </div>
      </div>

      <div class="sidebar-section-title">Navigation</div>
      <ul class="nav-links" id="nav-links">
        <li><a href="#top" class="active"><span class="icon-dot"></span>Overview</a></li>
        <li><a href="vaccinations.html> <a href="#section-vaccination"><span class="icon-dot"></span>Vaccinations</a></a></li>
        <li><a href="#section-appointments"><span class="icon-dot"></span>Appointments</a></li>
        <li><a href="#section-id"><span class="icon-dot"></span>Child Profile</a></li>
        <li><a href="#section-history"><span class="icon-dot"></span>Medical History</a></li>
        <li><a href="#section-diet"><span class="icon-dot"></span>Diet &amp; Nutrition</a></li>
      </ul>

      <div class="sidebar-footer">
        <span>Healthy Child, Happy Home</span>
        <span class="badge-soft">Beta</span>
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main" id="top">
      <header class="main-header">
        <div class="page-title">
          <h1>Child Health Dashboard</h1>
          <div class="page-subtitle">Track vaccinations, appointments &amp; profile in one place.</div>
        </div>
        <div class="user-chip">
          <button id="logout-btn">Logout</button>
          <div class="profile-icon" id="profile-icon">U</div>
        </div>
      </header>

      <!-- MODULE CARDS -->
      <section class="modules-strip">
        <div class="module-card" data-target="#section-vaccination">
          <div class="module-title-row">
            <h3>Vaccinations</h3>
            <span class="module-chip">Schedule &amp; status</span>
          </div>
          <div class="module-footnote">Keep every dose on time.</div>
        </div>

        <div class="module-card" data-target="#section-appointments">
          <div class="module-title-row">
            <h3>Appointments</h3>
            <span class="module-chip">Visits &amp; follow-ups</span>
          </div>
          <div class="module-footnote">Plan and review doctor visits.</div>
        </div>

        <div class="module-card" data-target="#section-id">
          <div class="module-title-row">
            <h3>Child Profile</h3>
            <span class="module-chip">Virtual ID</span>
          </div>
          <div class="module-footnote">One place for key details.</div>
        </div>

        <div class="module-card" data-target="#section-history">
          <div class="module-title-row">
            <h3>Medical History</h3>
            <span class="module-chip">Coming soon</span>
          </div>
          <div class="module-footnote">Allergies &amp; past illnesses.</div>
        </div>
      </section>

      <!-- TOP GRID: ID + VACC -->
      <section class="grid-2">
        <!-- VIRTUAL ID -->
        <div class="card" id="section-id">
          <h2 class="section-title">
            <span class="label">
              Virtual ID Card
            </span>
            <span class="section-pill">Personal Details</span>
          </h2>
          <p class="status-text">
            This card summarizes key information about your child linked to this account.
          </p>
          <div class="id-card">
            <div class="id-primary">
              <span class="label-small">Child Name</span>
              <div class="id-name-display" id="id-name">Loading...</div>
              <span class="label-small" style="margin-top:6px;">Parent Email</span>
              <div id="id-parent-email" style="font-size:13px;">-</div>
            </div>
            <div class="id-photo">
              Photo
            </div>
          </div>
        </div>

        <!-- VACCINATION OVERVIEW -->
        <div class="card" id="section-vaccination">
          <h2 class="section-title">
            <span class="label">
              Vaccination Record
            </span>
            <span class="section-pill" id="vaccination-count-pill">0 records</span>
          </h2>

          <div class="section-metrics" id="vacc-metrics"></div>

          <p class="status-text" id="vaccination-status">
            Add vaccination details to build an accurate history.
          </p>

          <form id="vaccination-form">
            <div class="form-inline">
              <input type="text" id="vac-vaccine" placeholder="Vaccine name · e.g. DPT" required />
              <input type="date" id="vac-scheduled" />
              <input type="date" id="vac-given" />
              <select id="vac-status">
                <option value="Scheduled">Scheduled</option>
                <option value="Given">Given</option>
                <option value="Missed">Missed</option>
              </select>
            </div>
            <button type="submit" class="btn-small" id="vac-submit-btn">
              <span>Save Vaccination</span>
            </button>
          </form>

          <div class="table-tools">
            <input type="text" id="vacc-search" placeholder="Search vaccine..." />
            <select id="vacc-filter-status">
              <option value="all">All statuses</option>
              <option value="Scheduled">Scheduled only</option>
              <option value="Given">Given only</option>
              <option value="Missed">Missed only</option>
            </select>
          </div>

          <table>
            <thead>
              <tr>
                <th>Vaccine</th>
                <th>Scheduled</th>
                <th>Given</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="vaccinationBody">
              <tr class="skeleton-row">
                <td><div class="skeleton"></div></td>
                <td><div class="skeleton"></div></td>
                <td><div class="skeleton"></div></td>
                <td><div class="skeleton"></div></td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- APPOINTMENTS + FUTURE MODULES -->
      <section class="grid-2">
        <!-- APPOINTMENTS -->
        <div class="card" id="section-appointments">
          <h2 class="section-title">
            <span class="label">
              Appointments
            </span>
            <span class="section-pill" id="appointments-count-pill">0 appointments</span>
          </h2>

          <div class="section-metrics" id="app-metrics"></div>

          <p class="status-text" id="appointments-status">
            Add upcoming or past doctor visits to keep everything organized.
          </p>

          <form id="appointments-form">
            <div class="form-inline">
              <input type="date" id="app-date" required />
              <input type="text" id="app-purpose" placeholder="Purpose · e.g. Routine checkup" required />
              <input type="text" id="app-doctor" placeholder="Doctor name (optional)" />
              <select id="app-status">
                <option value="Scheduled">Scheduled</option>
                <option value="Completed">Completed</option>
                <option value="Cancelled">Cancelled</option>
              </select>
            </div>
            <button type="submit" class="btn-small" id="app-submit-btn">
              <span>Save Appointment</span>
            </button>
          </form>

          <div class="table-tools">
            <select id="app-filter-status">
              <option value="all">All statuses</option>
              <option value="Scheduled">Scheduled only</option>
              <option value="Completed">Completed only</option>
              <option value="Cancelled">Cancelled only</option>
            </select>
          </div>

          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>Purpose</th>
                <th>Doctor</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="appointmentsBody">
              <tr class="skeleton-row">
                <td><div class="skeleton"></div></td>
                <td><div class="skeleton"></div></td>
                <td><div class="skeleton"></div></td>
                <td><div class="skeleton"></div></td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- FUTURE MODULES -->
        <div>
          <div class="card" id="section-history">
            <h2 class="section-title">
              <span class="label">Medical History</span>
              <span class="section-pill">Coming Soon</span>
            </h2>
            <p class="section-note">
              This area will show a timeline of past illnesses, allergies, and critical notes related to your child’s
              health. You’ll be able to attach notes to visits and vaccinations for a complete record.
            </p>
          </div>

          <div class="card" id="section-diet">
            <h2 class="section-title">
              <span class="label">Diet &amp; Nutrition</span>
              <span class="section-pill">Coming Soon</span>
            </h2>
            <p class="section-note">
              Plan meals, track growth milestones, and keep an eye on your child’s daily nutrition once this module is
              available.
            </p>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Toast -->
  <div id="toast"></div>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://hfytpmyqvdzdehembdpr.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhmeXRwbXlxdmR6ZGVoZW1iZHByIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzNTg3NzIsImV4cCI6MjA3NzkzNDc3Mn0.IBvAlibQX4ZpQeC1FMTPgPaD-2odx42Ec0CkilSGA4Y";

    const { createClient } = supabase;
    const sb = createClient(SUPABASE_URL, SUPABASE_KEY);

    let vaccinationCache = [];
    let appointmentsCache = [];

    function toggleMenu() {
      const sidebar = document.getElementById("sidebar");
      sidebar.classList.toggle("open");
    }

    function setProfileIcon(user) {
      const profileIcon = document.getElementById("profile-icon");
      const email = user.email || "";
      const letter = email ? email.charAt(0).toUpperCase() : "U";
      profileIcon.textContent = letter;
    }

    function pillForStatus(status) {
      if (!status) return "-";
      const s = status.toLowerCase();
      if (s === "given") return '<span class="pill pill-given">Given</span>';
      if (s === "missed") return '<span class="pill pill-missed">Missed</span>';
      if (s === "completed") return '<span class="pill pill-completed">Completed</span>';
      if (s === "cancelled") return '<span class="pill pill-cancelled">Cancelled</span>';
      if (s === "scheduled") return '<span class="pill pill-scheduled">Scheduled</span>';
      return status;
    }

    function showToast(message, type = "success") {
      const toast = document.getElementById("toast");
      toast.textContent = "";
      toast.className = "";
      if (type === "error") toast.classList.add("error");
      toast.innerHTML = (type === "error" ? "⚠️ " : "✅ ") + message;
      toast.classList.add("show");
      clearTimeout(showToast._timeoutId);
      showToast._timeoutId = setTimeout(() => {
        toast.classList.remove("show");
      }, 2500);
    }

    function setButtonLoading(buttonId, isLoading, defaultText) {
      const btn = document.getElementById(buttonId);
      if (!btn) return;
      if (isLoading) {
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner"></span><span>Saving...</span>';
      } else {
        btn.disabled = false;
        btn.innerHTML = '<span>' + defaultText + '</span>';
      }
    }

    function formatDate(dateStr) {
      if (!dateStr) return "-";
      const d = new Date(dateStr + "T00:00:00");
      if (isNaN(d.getTime())) return dateStr;
      return d.toLocaleDateString(undefined, {
        day: "2-digit",
        month: "short",
        year: "numeric"
      });
    }

    async function getCurrentUser() {
      const { data, error } = await sb.auth.getUser();
      if (error || !data.user) {
        window.location.href = "index.html";
        return null;
      }
      return data.user;
    }

    async function loadUserProfile(user) {
      const nameEl = document.getElementById("id-name");
      const emailEl = document.getElementById("id-parent-email");

      nameEl.textContent = "Loading...";
      emailEl.textContent = user.email || "";

      const { data: row, error } = await sb
        .from("users")
        .select("*")
        .eq("id", user.id)
        .maybeSingle();

      if (error) {
        console.error("Error loading users row:", error);
        nameEl.textContent = user.user_metadata?.name || "(no name)";
        return;
      }

      if (!row) {
        nameEl.textContent = user.user_metadata?.name || "(no name)";
      } else {
        nameEl.textContent = row.name || "(no name)";
        emailEl.textContent = row.email || user.email || "";
      }
    }

    function renderVaccinationMetrics(data) {
      const metricsEl = document.getElementById("vacc-metrics");
      if (!data || data.length === 0) {
        metricsEl.innerHTML = "";
        return;
      }
      const total = data.length;
      const given = data.filter(r => (r.status || "").toLowerCase() === "given").length;
      const scheduled = data.filter(r => (r.status || "").toLowerCase() === "scheduled").length;
      const missed = data.filter(r => (r.status || "").toLowerCase() === "missed").length;

      metricsEl.innerHTML = `
        <div class="metric-pill">
          <span class="metric-label">Total</span>
          <span class="metric-value">${total}</span>
        </div>
        <div class="metric-pill">
          <span class="metric-label">Given</span>
          <span class="metric-value">${given}</span>
        </div>
        <div class="metric-pill">
          <span class="metric-label">Scheduled</span>
          <span class="metric-value">${scheduled}</span>
        </div>
        <div class="metric-pill">
          <span class="metric-label">Missed</span>
          <span class="metric-value">${missed}</span>
        </div>
      `;
    }

    function renderVaccinationRows() {
      const tbody = document.getElementById("vaccinationBody");
      const searchVal = document.getElementById("vacc-search").value.trim().toLowerCase();
      const statusFilter = document.getElementById("vacc-filter-status").value;
      tbody.innerHTML = "";

      let filtered = vaccinationCache.slice();

      if (searchVal) {
        filtered = filtered.filter(row =>
          (row.vaccine || "").toLowerCase().includes(searchVal)
        );
      }

      if (statusFilter !== "all") {
        filtered = filtered.filter(row => (row.status || "") === statusFilter);
      }

      if (filtered.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="table-empty">No vaccination records match this filter.</td></tr>';
        return;
      }

      filtered.forEach(row => {
        const tr = document.createElement("tr");
        tr.style.opacity = 0;
        tr.innerHTML = `
          <td>${row.vaccine || "-"}</td>
          <td>${formatDate(row.scheduled_date)}</td>
          <td>${formatDate(row.given_date)}</td>
          <td>${pillForStatus(row.status)}</td>
        `;
        tbody.appendChild(tr);
        requestAnimationFrame(() => {
          tr.style.transition = "opacity 0.25s ease";
          tr.style.opacity = 1;
        });
      });
    }

    async function loadVaccinations(userId) {
      const tbody = document.getElementById("vaccinationBody");
      const statusEl = document.getElementById("vaccination-status");
      const countPill = document.getElementById("vaccination-count-pill");
      const metricsEl = document.getElementById("vacc-metrics");

      tbody.innerHTML = `
        <tr class="skeleton-row">
          <td><div class="skeleton"></div></td>
          <td><div class="skeleton"></div></td>
          <td><div class="skeleton"></div></td>
          <td><div class="skeleton"></div></td>
        </tr>
      `;
      metricsEl.innerHTML = "";

      const { data, error } = await sb
        .from("vaccinations")
        .select("vaccine, scheduled_date, given_date, status, user_id")
        .eq("user_id", userId)
        .order("scheduled_date", { ascending: true });

      if (error) {
        console.error("Vaccination fetch error:", error);
        tbody.innerHTML = '<tr><td colspan="4" class="table-empty">Error loading data</td></tr>';
        statusEl.textContent = "Error loading vaccination records.";
        countPill.textContent = "0 records";
        return;
      }

      if (!data || data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="table-empty">No vaccination records yet. Please add above.</td></tr>';
        statusEl.textContent = "No vaccination records found yet.";
        countPill.textContent = "0 records";
        metricsEl.innerHTML = "";
        vaccinationCache = [];
        return;
      }

      vaccinationCache = data;
      statusEl.textContent = "Showing vaccination records.";
      countPill.textContent = data.length + (data.length === 1 ? " record" : " records");
      renderVaccinationMetrics(data);
      renderVaccinationRows();
    }

    async function addVaccination(e) {
      e.preventDefault();

      const vaccine = document.getElementById("vac-vaccine").value.trim();
      const scheduled = document.getElementById("vac-scheduled").value || null;
      const given = document.getElementById("vac-given").value || null;
      const status = document.getElementById("vac-status").value;

      if (!vaccine) return;

      setButtonLoading("vac-submit-btn", true, "Save Vaccination");

      const { error } = await sb
        .from("vaccinations")
        .insert({
          vaccine: vaccine,
          scheduled_date: scheduled,
          given_date: given,
          status: status
        });

      setButtonLoading("vac-submit-btn", false, "Save Vaccination");

      if (error) {
        console.error("Error inserting vaccination:", error);
        showToast("Error saving vaccination", "error");
        alert("Error saving vaccination: " + (error.message || "check console"));
        return;
      }

      e.target.reset();
      document.getElementById("vac-status").value = "Scheduled";
      showToast("Vaccination saved");

      const user = await getCurrentUser();
      if (user) {
        await loadVaccinations(user.id);
      }
    }

    function renderAppointmentMetrics(data) {
      const metricsEl = document.getElementById("app-metrics");
      if (!data || data.length === 0) {
        metricsEl.innerHTML = "";
        return;
      }

      const total = data.length;
      const scheduled = data.filter(r => (r.status || "").toLowerCase() === "scheduled").length;
      const completed = data.filter(r => (r.status || "").toLowerCase() === "completed").length;
      const cancelled = data.filter(r => (r.status || "").toLowerCase() === "cancelled").length;

      metricsEl.innerHTML = `
        <div class="metric-pill">
          <span class="metric-label">Total</span>
          <span class="metric-value">${total}</span>
        </div>
        <div class="metric-pill">
          <span class="metric-label">Scheduled</span>
          <span class="metric-value">${scheduled}</span>
        </div>
        <div class="metric-pill">
          <span class="metric-label">Completed</span>
          <span class="metric-value">${completed}</span>
        </div>
        <div class="metric-pill">
          <span class="metric-label">Cancelled</span>
          <span class="metric-value">${cancelled}</span>
        </div>
      `;
    }

    function renderAppointmentRows() {
      const tbody = document.getElementById("appointmentsBody");
      const statusFilter = document.getElementById("app-filter-status").value;
      tbody.innerHTML = "";

      let filtered = appointmentsCache.slice();

      if (statusFilter !== "all") {
        filtered = filtered.filter(row => (row.status || "") === statusFilter);
      }

      if (filtered.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="table-empty">No appointments match this filter.</td></tr>';
        return;
      }

      filtered.forEach(row => {
        const tr = document.createElement("tr");
        tr.style.opacity = 0;
        tr.innerHTML = `
          <td>${formatDate(row.date)}</td>
          <td>${row.purpose || "-"}</td>
          <td>${row.doctor || "-"}</td>
          <td>${pillForStatus(row.status)}</td>
        `;
        tbody.appendChild(tr);
        requestAnimationFrame(() => {
          tr.style.transition = "opacity 0.25s ease";
          tr.style.opacity = 1;
        });
      });
    }

    async function loadAppointments(userId) {
      const tbody = document.getElementById("appointmentsBody");
      const statusEl = document.getElementById("appointments-status");
      const countPill = document.getElementById("appointments-count-pill");
      const metricsEl = document.getElementById("app-metrics");

      tbody.innerHTML = `
        <tr class="skeleton-row">
          <td><div class="skeleton"></div></td>
          <td><div class="skeleton"></div></td>
          <td><div class="skeleton"></div></td>
          <td><div class="skeleton"></div></td>
        </tr>
      `;
      metricsEl.innerHTML = "";

      const { data, error } = await sb
        .from("appointments")
        .select("date, purpose, doctor, status, user_id")
        .eq("user_id", userId)
        .order("date", { ascending: true });

      if (error) {
        console.error("Appointments fetch error:", error);
        tbody.innerHTML = '<tr><td colspan="4" class="table-empty">Error loading data</td></tr>';
        statusEl.textContent = "Error loading appointments.";
        countPill.textContent = "0 appointments";
        return;
      }

      if (!data || data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="table-empty">No appointments yet. Please add above.</td></tr>';
        statusEl.textContent = "No appointments found yet.";
        countPill.textContent = "0 appointments";
        metricsEl.innerHTML = "";
        appointmentsCache = [];
        return;
      }

      appointmentsCache = data;
      statusEl.textContent = "Showing appointments.";
      countPill.textContent = data.length + (data.length === 1 ? " appointment" : " appointments");
      renderAppointmentMetrics(data);
      renderAppointmentRows();
    }

    async function addAppointment(e) {
      e.preventDefault();

      const date = document.getElementById("app-date").value;
      const purpose = document.getElementById("app-purpose").value.trim();
      const doctor = document.getElementById("app-doctor").value.trim() || null;
      const status = document.getElementById("app-status").value;

      if (!date || !purpose) return;

      setButtonLoading("app-submit-btn", true, "Save Appointment");

      const { error } = await sb
        .from("appointments")
        .insert({
          date: date,
          purpose: purpose,
          doctor: doctor,
          status: status
        });

      setButtonLoading("app-submit-btn", false, "Save Appointment");

      if (error) {
        console.error("Error inserting appointment:", error);
        showToast("Error saving appointment", "error");
        alert("Error saving appointment: " + (error.message || "check console"));
        return;
      }

      e.target.reset();
      document.getElementById("app-status").value = "Scheduled";
      showToast("Appointment saved");

      const user = await getCurrentUser();
      if (user) {
        await loadAppointments(user.id);
      }
    }

    function initModuleCardScroll() {
      const cards = document.querySelectorAll(".module-card");
      cards.forEach(card => {
        card.addEventListener("click", () => {
          const targetSelector = card.getAttribute("data-target");
          if (targetSelector) {
            const section = document.querySelector(targetSelector);
            if (section) {
              section.scrollIntoView({ behavior: "smooth", block: "start" });
            }
          }
          cards.forEach(c => c.classList.remove("active"));
          card.classList.add("active");
          setTimeout(() => card.classList.remove("active"), 800);
        });
      });
    }

    function initSidebarActiveLinks() {
      const links = document.querySelectorAll("#nav-links a");
      links.forEach(link => {
        link.addEventListener("click", () => {
          links.forEach(l => l.classList.remove("active"));
          link.classList.add("active");
        });
      });
    }

    document.addEventListener("DOMContentLoaded", async () => {
      initModuleCardScroll();
      initSidebarActiveLinks();

      const user = await getCurrentUser();
      if (!user) return;

      setProfileIcon(user);
      await loadUserProfile(user);

      const userId = user.id;

      document.getElementById("vaccination-form").addEventListener("submit", addVaccination);
      document.getElementById("appointments-form").addEventListener("submit", addAppointment);

      document.getElementById("logout-btn").addEventListener("click", async () => {
        await sb.auth.signOut();
        window.location.href = "index.html";
      });

      document.getElementById("vacc-search").addEventListener("input", renderVaccinationRows);
      document.getElementById("vacc-filter-status").addEventListener("change", renderVaccinationRows);
      document.getElementById("app-filter-status").addEventListener("change", renderAppointmentRows);

      await loadVaccinations(userId);
      await loadAppointments(userId);
    });
  </script>
</body>
</html>

